<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-DO List - Pivot</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel='stylesheet' href="../style.css">
    
</head>
<body>
    <div id="nav-placeholder">
    </div>

    <!-- SIDENAV -->
    
    <div class="sidenav">

            <a href="#about" class ="text-center mt-4">TO-DO LIST</a>
            <hr class="solid" id="hrWhite2">
            <a href="#services" class ="mt-3">MAJOR TASK</a>
      

    </div>

    <!-- TODO LIST -->
   
    <section class="pt-3 pb-5">
        <div class="container">
            <div class="row">
                <!-- INDIV TODO LIST -->
                <div class = "container todoContainer">
              <div class="col-4">
                <div class="card todoCard">
                   
                    <span class = "todoTitle text-center mt-4">TODO LIST</span>
                    <hr class="solid" id="hrBlack">
                    <div class="card-body overflow-auto scroll" id="todoBody">
                       <!-- SUB TASK -->
                       <div id="todo_list">
                       <!-- list of todo -->
                       </div>
                            <div id="todo_input" class ="card subTask text-center mb-3" hidden>
                                    <div class = "row" id="accordionExample">
                                        <div class = "col-10 text-left" id="subTaskName">
                                            <input type="text" class = "taskName" id="todoName" placeholder="Task Name">
                                        </div>
                                        <div class = "col-2 mt-1" id="subTaskName">
                                            <button class = "moreBtn" id = "collapsible"  data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                   <i class="fa fa-ellipsis-h" style="font-size:20px" id="indivIcon"></i>
                                                </button>
                                        </div>
                                        <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                                            <hr class="solid" id="hrBlack">
                                            <div class = "noteSubTask">
                                                
                                            </div>
                                            <hr class="solid" id="hrBlack">
                                            <div class ="row">
                                                <div class = "col-6">
                                                    <button class = "btn" id ="subBtn2" onclick="document.getElementById('todo_input').hidden = true;">CANCEL</button>
                                                </div>
                                                <div class = "col-6">
                                                    <button class = "btn" id = "subBtn" onclick="insertTodo()" >SAVE</button>
                                                </div>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        
                            
                        <!-- END OF ONE SUBTASK-->
                        <!-- ADD A SUB TASK -->
                        <div class ="card addSubTask text-center mb-3">
                            <div class = "row">
                                <div class = "col text-center" id="subTaskName">
                                    <i class="fa fa-plus-circle" style="font-size:16px"></i>
                                    
                                    <span class = "ml-2" onclick="openTodoInput()">Add A Sub-Task</span>
                                </div>
                               
                        </div>
                    </div>
                <!-- END OF ADD A SUBTASK-->
                           
                            
                            
                       
                    </div>
                    <div class="card-footer bg-transparent">  
                    </div>
                </div>
              </div>
              <!-- END -->

              <!-- INDIV MAJOR TASK TODO LIST -->
              <div class="col-4" id="tasks_view">
                
              </div>
                <!-- <div class="col-4"> -->
                  <!-- <div class="card todoCard">
                      <div class = "text-right"> 
                          <div class = "dropdown">
                          <button class="btn btn-secondary" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style = "background-color: transprent; border-color: transparent;"><i class="fa fa-caret-square-down" id="todoDrop" ></i></button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                              <a class="dropdown-item" href="../todoTimer.html">Convert to Session</a>
                              <a class="dropdown-item" href="#" >Edit Task Name</a>
                              <a class="dropdown-item" href="#">Delete Task</a>
                          </div>
                            </div></div>
                      <span id = "content" class = "todoTitle text-center">MAJOR TASK</span>
                      <hr class="solid" id="hrBlack">
                      <span class = "todoTitle text-center">25:00</span>
                      <span class = "todoTime text-center">Time per session</span>
                      <hr class="solid" id="hrBlack">
                      <div class="card-body overflow-auto scroll" id="todoMajorBody">
                         
                              <div class ="card subTask text-center mb-3">
                                      <div class = "row" id="accordionExample2">
                                          <div class = "col-10 text-left" id="subTaskName">
                                            <input type="text"  class = "taskName" placeholder="Task Name">
                                          </div>
                                          <div class = "col-2 mt-1" id="subTaskName">
                                              <button class = "moreBtn" id = "collapsible"  data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                                                     <i class="fa fa-ellipsis-h" style="font-size:20px" id="indivIcon"></i>
                                                  </button>
                                          </div>
                                          <div id="collapseTwo" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample2">
                                              <hr class="solid" id="hrBlack">
                                              <div class = "noteSubTask">
  
                                              </div>
                                              <hr class="solid" id="hrBlack">
                                              <div class ="row">
                                                <div class = "col-6">
                                                    <button class = "btn" id ="subBtn2">REMOVE</button>
                                                </div>
                                                <div class = "col-6">
                                                    <button class = "btn" id = "subBtn" >SAVE</button>
                                                </div>
                                            </div>
                                          </div>
                                  </div>
                                 
                              </div>
                         
                          <div class ="card addSubTask text-center mb-3">
                              <div class = "row">
                                  <div class = "col text-center" id="subTaskName">
                                      <i class="fa fa-plus-circle" style="font-size:16px"></i>
                                      <span class = "ml-2">Add A Sub-Task</span>
                                  </div>
                          </div>
                      </div>
                      </div>
                  
                         
                      <div class="card-footer bg-transparent">  
                      </div>
                  </div> -->
                  <!-- </div> -->
               
                <!-- END -->
            <!-- ADD A GROUPED TODO LIST -->
            <div class="col-4">
                <div class="card todoAddCard1">
                    <div class = "row">
                        <div class = "col text-center mt-4 mb-2" id="subTaskName">
                            <a href="createGrouped.html" class="btn" role="button" class = "ml-2" id = "toDoDec"> <i class="fa fa-plus-circle" style="font-size:16px; margin-right: 3px"></i> Add A Grouped Task (Card)</a>
                        </div>
                </div>
                </div>
                <div class="card-footer bg-transparent">  
                </div>
            </div>
            <!-- END -->
          </div>
          </div>


              
          
    </section>




    <!-- SCRIPTS -->

    <!-- HIDE AND SHOW
    <script>
         const targetDiv = document.getElementById("div-hide");
         const btn = document.getElementById("toggle");
        btn.onclick = function () {
          if (targetDiv.style.display !== "none") {
           targetDiv.style.display = "none";
        } else {
        targetDiv.style.display = "block";
        }
    }; -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
       var $template = $(".template");

        var hash = 2;
        $(".btn-add-panel").on("click", function () {
            var $newPanel = $template.clone();
            $newPanel.find(".collapse").removeClass("in");
            $newPanel.find(".accordion-toggle").attr("href",  "#" + (++hash))
                    .text("Dynamic panel #" + hash);
            $newPanel.find(".panel-collapse").attr("id", hash).addClass("collapse").removeClass("in");
            $("#accordion").append($newPanel.fadeIn());
        });

//testing
//group task
        $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/group_task.php",
                dataType: "json",
                data:{
                    user_id: localStorage.getItem('user_id'),
                    // last_name:  localStorage.getItem('last_name'),
                    // user_name:  localStorage.getItem('user_name'),
                    // password: localStorage.getItem('password'),
                    // email: localStorage.getItem('email'),
                },
                
                cache:false,
                success: function(dataResult){
                    // alert(dataResult.message)
                    // if (dataResult.status){
                    //     //path nung pag lalandingan niya
                    //     window.location.href = "../timer.html";
                    // }
                    var innerHtml = ''
                    for (let i = 0; i < dataResult.length; i++) {
                        innerHtml+='<div class="card todoCard">'
                        innerHtml+='<div class = "text-right">'
                        innerHtml+='<div class = "dropdown">'
                        innerHtml+='<button class="btn btn-secondary" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style = "background-color: transprent; border-color: transparent;"><i class="fa fa-caret-square-down" id="todoDrop" ></i></button>'
                        innerHtml+='<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">'
                        innerHtml+='<a class="dropdown-item" href="../todoTimer.html">Convert to Session</a>'
                        innerHtml+='<a class="dropdown-item" href="#" >Edit Task Name</a>'
                        innerHtml+='<a class="dropdown-item" href="#" onclick="removeMajorTask('+"'"+dataResult[i]._id['$oid']+"'"+')">Delete Task</a>'
                        innerHtml+='</div></div></div>'
                        innerHtml+='<span id = "content" class = "todoTitle text-center">'+dataResult[i].task_name+'</span>'
                        innerHtml+='<hr class="solid" id="hrBlack">'
                        innerHtml+='<span class = "todoTitle text-center">25:00</span>'
                        innerHtml+='<span class = "todoTime text-center">Time per session</span>'
                        innerHtml+='<hr class="solid" id="hrBlack">'
                        innerHtml+='<div class="card-body overflow-auto scroll" id="todoMajorBody">'
                        innerHtml+='<div class ="card subTask text-center mb-3">'
                        innerHtml+='<div class = "row" id="accordionExample2">'
                        innerHtml+='<div class = "col-10 text-left" id="subTaskName">'
                        innerHtml+='<input type="text"  class = "taskName" placeholder="Task Name">'
                        innerHtml+='</div><div class = "col-2 mt-1" id="subTaskName"><button class = "moreBtn" id = "collapsible"  data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">'
                        innerHtml+='<i class="fa fa-ellipsis-h" style="font-size:20px" id="indivIcon"></i></button></div>'
                        innerHtml+='<div id="collapseTwo" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample2">'
                        innerHtml+='<hr class="solid" id="hrBlack">'
                        innerHtml+='<div class = "noteSubTask"></div><hr class="solid" id="hrBlack"><div class ="row"><div class = "col-6"><button class = "btn" id ="subBtn2">REMOVE</button></div><div class = "col-6">'
                        innerHtml+='<button class = "btn" id = "subBtn" >SAVE</button></div></div></div></div></div>'
                        innerHtml+='<div class ="card addSubTask text-center mb-3">'
                        innerHtml+='<div class = "row"><div class = "col text-center" id="subTaskName"><i class="fa fa-plus-circle" style="font-size:16px"></i><span class = "ml-2">Add A Sub-Task</span></div></div></div></div><div class="card-footer bg-transparent"></div></div>'
                        }

                        $('#tasks_view').html(innerHtml)
                    

                },error:function(err){
            console.log('error')		 
            }
        })



        $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/display_todo.php",
                dataType: "json",
                data:{
                    user_id: localStorage.getItem('user_id'),
                },
                
                cache:false,
                success: function(dataResult){
                    // alert(dataResult.message)
                    // if (dataResult.status){
                    //     //path nung pag lalandingan niya
                    //     window.location.href = "../timer.html";
                    // }
                    var innerHtml = ''
                    for (let i = 0; i < dataResult.length; i++) {
                        // var id = "'"+dataResult[0]._id['$oid']+"'"
                        innerHtml+="<div class ='card subTask text-center mb-3'>"
                            innerHtml+="<div class = 'row' id='accordionExample'>"
                                innerHtml+="<div class = 'col-10 text-left' id='subTaskName'>"
                                    innerHtml+="<input type='text' id='todoName"+i+"' placeholder='Task Name' value='"+dataResult[i].todo_name+"' disabled='true'>"
                                    innerHtml+="</div>"
                                    innerHtml+="<div class = 'col-2 mt-1' id='subTaskName'>"
                                        innerHtml+="<button class = 'moreBtn' id = 'collapsible'  data-toggle='collapse' data-target='#collapseOne"+i+"' aria-expanded='true' aria-controls='collapseOne' onclick='disableOwnInput("+i+")'>"
                                            innerHtml+="<i class='fa fa-ellipsis-h' style='font-size:20px' id='indivIcon'></i>"
                                            innerHtml+="</button>"
                                            innerHtml+="</div>"
                                            innerHtml+="<div id='collapseOne"+i+"' class='collapse' aria-labelledby='headingOne' data-parent='#accordionExample'>"
                                                innerHtml+="<hr class='solid' id='hrBlack'>"
                                                innerHtml+="<div class = 'noteSubTask'>"
                                                    innerHtml+="</div>"
                                                    innerHtml+="<hr class='solid' id='hrBlack'>"
                                                    innerHtml+="<div class ='row'>"
                                                        innerHtml+="<div class = 'col-6'>"
                                                            innerHtml+='<button class = "btn" id ="subBtn2" onclick="remove('+"'"+dataResult[i]._id['$oid']+"'"+')">REMOVE</button>'
                                                            innerHtml+="</div>"
                                                            innerHtml+="<div class = 'col-6'>"
                                                                innerHtml+='<button class = "btn" id = "subBtn" onclick="UpdateTodo('+"'"+dataResult[i]._id['$oid']+"'"+','+i+')" >SAVE</button>'
                                                                innerHtml+="</div>"
                                                                innerHtml+="</div>"
                                                                innerHtml+="</div>"
                                                                innerHtml+="</div>"
                                                                innerHtml+="</div>"
                   
                    }

                    $('#todo_list').html(innerHtml)

                    //     $('#tasks_view').html(innerHtml)
                    

                },error:function(err){
            console.log('error')		 
            }
        })
        function disableOwnInput(res){
           document.getElementById('todoName'+res).disabled = !document.getElementById('todoName'+res).disabled
        }

       function openTodoInput(){
        document.getElementById('todo_input').hidden = false
       }
       function insertTodo(){
        var user_id = localStorage.getItem('user_id');
        var todo_name = document.getElementById('todoName').value

        $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/add_todo.php",
                dataType: "json",
                 data:{
                    todo_name: todo_name,
                    user_id: user_id
                },
                
                cache:false,
                success: function(dataResult){
                    console.log(dataResult.status)
                },error:function(err){
              console.log('error')		 
            }
            })

            location.reload();
       }
       function remove(res){

        // console.log(res)
        $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/delete_todo.php",
                dataType: "json",
                 data:{
                    todo_id: res
                },
                
                cache:false,
                success: function(dataResult){
                    console.log(dataResult.status)
                },error:function(err){
              console.log('error')		 
            }
            })
            location.reload();
       }
       function removeMajorTask(res){
        $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/delete_major_task.php",
                dataType: "json",
                 data:{
                    task_id: res
                },
                
                cache:false,
                success: function(dataResult){
                    console.log(dataResult.status)
                },error:function(err){
              console.log('error')		 
            }
            })
            location.reload();
       }
       function UpdateTodo(id,input){
        var todoName = document.getElementById('todoName'+input).value
        $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/update_todo.php",
                dataType: "json",
                 data:{
                    todo_id: id,
                    input: todoName
                },
                
                cache:false,
                success: function(dataResult){
                    alert('Update Success')
                },error:function(err){
              console.log('error')		 
            }
            })
       }
     </script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script>
    $.get("../navigationBar.html", function(data){
        $("#nav-placeholder").replaceWith(data);
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    <!-- EDIT TASK NAME BUT NOT YET DYNAMIC AND STORED ON LOCAL STORAGE-->
    <script>
        window.onload = function() {
	if(localStorage.getItem('content')) {
		document.querySelector('.content').innerHTML = localStorage.getItem('content');
    }
    }

    let editBtn = document.querySelector('#edit_content');
    let content = document.querySelector('.todoTitle');

    editBtn.addEventListener('click', () => {
        content.contentEditable = !content.isContentEditable;
    if(content.contentEditable === 'false') {
        localStorage.setItem('content', content.innerHTML);
    }
    });
    </script>


</body>
</html>