<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Pivot</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel='stylesheet' href="../style.css">
    
</head>
<body>
    <div id="nav-placeholder">
    </div>

    <div class="container px-5 py-4 mx-auto">
        <div class="container d-flex justify-content-around ">
            <div class = "row">
            <span class = "titleRoutine text-center">
                REPORTS
                <hr class="solid" id="hrWhite2">
            </span>
        </div>
        </div>
        <!-- SUMMARY OF ROUTINE -->
        <div class="container d-flex justify-content-around ">
            <div class = "row text-center">
                <div class = "col-lg-3">
                    <div class = "row">
                        <div class = "card userInfoReportsCard">
                            <span class = "titleRoutine1" id = "user_Name" >
                                USERNAME
                            </span>
                            <hr class = "hrWhite">
                            <span class = "inputNameReports text-center" id ="firstName">
                                firstName
                            </span>
                            <small class = "text-center">
                                First Name
                            </small>
                            <span class = "inputNameReports text-center mt-2" id = "lastName">
                                lastName
                            </span>
                            <small class = "text-center">
                                Last Name
                            </small>
                            <span class = "inputNameReports text-center mt-2" id = "email">
                                emailaddress@email.com
                            </span>
                            <small class = "text-center">
                                Email
                            </small>
                        </div>
                       
                    </div>
                    
                   </div>
                   
                <!-- SUB ROUTINES -->
                <div class = "col-lg-9">
                    <div class = "card reportsCard">
                        <div class = "row">
                            <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-right">
                                        DATE STARTED:
                                    </span>
                                    <div class = "col text-right mb-3">
                                        <input type="date" id="start_date" class = "dateReportS">
                                    </div>
                                </div>   
                            </div>
                            <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-left">
                                        DATE ENDED:
                                    </span>
                                    <div class = "col text-left">
                                        <input type="date" id="end_date" class = "dateReportS">
                                    </div>
                                </div>   
                            </div>
                            <div class = "row text-center">
                                <div class = "col mb-4">
                                    <button type = "button" class = "btn" id = "reportsSort" onclick="showReports()">SORT
                                    </button>
                                </div>

                            </div>
                       
                            <hr class = "hrWhite">
                            <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-center">
                                        NO. OF TASKS COMPLETED:
                                    </span>
                                    <div class = "summaryNo text-center" id = "todoSummary1">
                                        10
                                    </div>
                                </div> 
                             </div>
                             <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-center">
                                        NO. OF ROUTINES COMPLETED:
                                    </span>
                                    <div class = "summaryNo text-center" id = "routineSummary">
                                        10
                                    </div>
                                </div> 
                             </div>
                        </div>
                       
                        <hr class = "hrWhite">
                        <span class = "titleReports text-left">
                            TASK COMPLETED
                        </span>
                        <div class = "reportsTableCard">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th colspan="2">TASK NAME</th>
                                    <th scope="col-2">TIME PER SESSION</th>
                                    <th scope="col-2">NO. OF SUBTASKS</th>
                                    <th scope="col-2">TIME/DATE STARTED</th>
                                    <th scope="col-2">TIME/DATE COMPLETED</th>
                                  </tr>
                                </thead>
                                <tbody id="task">
                                    <!-- ONE TASK REPORT -->
                                  <tr>
                                    <td colspan="2" class = "text-left">PROGRAMMING</td>
                                    <td>25:00</td>
                                    <td>4</td>
                                    <td>21:00/06-11-2022</td>
                                    <td>23:00/06-11-2022</td>
                                  </tr>
                                  <!-- END OF ONE TASK REPORT -->
                                </tbody>
                            </table>
                        </div>
                        <hr class = "hrWhite">
                        <span class = "titleReports text-left">
                            ROUTINES COMPLETED
                        </span>
                        <div class = "reportsTableCard">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th colspan="2">ROUTINE NAME</th>
                                    <th scope="col-2">TIME PER SESSION</th>
                                    <th scope="col-2">NO. OF SUBTASKS</th>
                                    <th scope="col-2">NO. OF TIMES</th>
                                    <th scope="col-2">ACTION</th>
                                  </tr>
                                </thead>
                                <tbody id="routine">
                                    <!-- ONE ROUTINE REPORT -->
                                  <tr>
                                    <td colspan="2" class = "text-left">WEEKLY ACTIVITY</td>
                                    <td>30:00</td>
                                    <td>6</td>
                                    <td>3</td>
                                  </tr>
                                  <!-- END OF ONE ROUTINE REPORT -->
                                </tbody>
                            </table>
                        </div>
                        <div id="viewMoreModal2" role="dialog"></div>
                        <hr class = "hrWhite">
                        <span class = "titleReports text-left">
                            ASSESSMENTS COMPLETED
                        </span>
                        <div class = "reportsTableCard">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th scope="col-2">#</th>
                                    <th scope="col-2">POINTS</th>
                                    <th colspan="2">CURRENT TIME MANAGEMENT SKILL</th>
                                    <th scope="col-2">TIME/DATE COMPLETED</th>
                                    
                                  </tr>
                                </thead>
                                <tbody id="assessments">
                                    <!-- ONE ROUTINE REPORT -->
                                  <tr>
                                    
                                    <td>01</td>
                                    <td>48</td>
                                    <td colspan="2" class = "text-left">You have excellent time mangament skills and should use this guide as a reference</td>
                                    <td>06-11-2022</td>
                                  </tr>
                                  <!-- END OF ONE ROUTINE REPORT -->
                                </tbody>
                            </table>
                        </div>


                                


                    </div>
                </div>
           
            </div>

            <script src="//code.jquery.com/jquery.min.js"></script>
            <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script src="sweetalert2.all.min.js"></script>
            <link rel="stylesheet" href="sweetalert2.min.css">
            <script>
            $.get("../navigationBar.html", function(data){
                $("#nav-placeholder").replaceWith(data);
                });
            </script>
            <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
            <script>
                window.onload = function() {
                    window.onpageshow = function (event) {
                    if (event.persisted) {
                        window.location.reload(); 
                    }
                    };
                }
            
            
            if(!localStorage.getItem('user_id')){
               
                        window.location = "http://localhost/pomodoro/user/login.html";
                  
                    
                }
            $.ajax({
                type:"POST",
                url: "http://localhost/pomodoro/api/user_info.php",
                dataType: "json",
                data:{
                    user_id: localStorage.getItem('user_id'),
                },
                
                cache:false,
                success: function(dataResult){
                        $('#user_Name').html(dataResult.user_name)
                        $('#firstName').html(dataResult.Fname)
                        $('#lastName').html(dataResult.Lname)
                        $('#email').html(dataResult.email)
                        },error:function(err){
                    console.log('error')		 
                    }
            })
            </script>
            <script>
                showReports()
                var start_date = document.getElementById('start_date').value
                var end_date = document.getElementById('end_date').value

                if(start_date == '' && end_date == ''){
                    end_date_default = dateToday();
                    var end_date = document.getElementById('end_date').value = end_date_default
                    start_date_default =  getLastWeeksDate();
                    var start_date = document.getElementById('start_date').value = start_date_default
                    submitFilter()

                } else {
                    submitFilter()
                }
                
                function getLastWeeksDate() {
                    const now = new Date();

                    var dtLastWeek = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    var month = dtLastWeek.getMonth() + 1;
                    var day = dtLastWeek.getDate();
                    var year = dtLastWeek.getFullYear();
                    var hr = dtLastWeek.getHours();
                    var min = dtLastWeek.getMinutes();
                    if(month < 10)
                        month = '0' + month.toString();
                    if(day < 10)
                        day = '0' + day.toString();
                    var lastWeek = year + '-' + month + '-' + day;
                    
                    return lastWeek
                }
                function dateToday(){
                    var dtToday = new Date();
                    var month = dtToday.getMonth() + 1;
                    var day = dtToday.getDate();
                    var year = dtToday.getFullYear();
                    var hr = dtToday.getHours();
                    var min = dtToday.getMinutes();
                    if(month < 10)
                        month = '0' + month.toString();
                    if(day < 10)
                        day = '0' + day.toString();
                    var todayDate = year + '-' + month + '-' + day;
                    return todayDate
                }

                function submitFilter(){
                    var start_date = document.getElementById('start_date').value
                    if(start_date != ''){
                        console.log(start_date)
                    }else{
                        console.log('error')
                    }
                    
                }
                function showReports(){
                    var params = null
                    
                 $.ajax({
                        type:"POST",
                        url: "http://localhost/pomodoro/api/reports.php",
                        dataType: "json",
                        data:{
                            end_date: document.getElementById('end_date').value,
                            start_date: document.getElementById('start_date').value,
                            user_id: localStorage.getItem('user_id'),
                        },
                        
                        cache:false,
                        success: function(dataResult){
                            var arrayAssessments = dataResult.assessments;
                            var arrayTask = dataResult.task;
                            var arrayRoutine = dataResult.routine;
                            console.log(dataResult)

                            var innerHtmlAssessments = ''
                            var innerHtmlTask = ''
                            var innerHtmlRoutine = ''
                            var innerHtmlTodoSummary = ''
                            var innerHtmlRoutineModal = ''
                            var innerHtmlRoutineSummary = ''
                           
                            
                            for(let i = 0; dataResult.assessments.length > i; i++){
                                var managementSkill = ''
                                if(arrayAssessments[i].points >= 45 && arrayAssessments[i].points <= 50 ){
                                    managementSkill = 'You have excellent time mangament skills and should use this guide as a reference	 '
                                }else if(arrayAssessments[i].points >= 30 && arrayAssessments[i].points <= 44){
                                    managementSkill = 'You manage your time fairly well but should use this guide to increase skill'

                                }else{
                                    managementSkill = 'Your time management skill should be improved for college but not panic, following the subsquent guidelines will assist you in improving your ability and further your chances of success'
                                }
                                innerHtmlAssessments+='<tr>'
                                innerHtmlAssessments+='<td>'+parseInt(i+1)+'</td>'
                                innerHtmlAssessments+='<td>'+arrayAssessments[i].points+'</td>'
                                innerHtmlAssessments+='<td colspan="2" class = "text-center">'+managementSkill+'</td>'
                                innerHtmlAssessments+='<td>'+arrayAssessments[i].date_created+'/'+arrayAssessments[i].time_created+'</td>'
                                innerHtmlAssessments+='</tr>'
                            }
                            for(let i = 0; dataResult.task.length > i; i++){
                                todoSum = i;
                                innerHtmlTask+='<tr>'
                                innerHtmlTask+='<td colspan="2" class = "text-left">'+arrayTask[i].task_name+'</td>'
                                innerHtmlTask+='<td>'+arrayTask[i].pomodoro+':00</td>'
                                innerHtmlTask+='<td>'+arrayTask[i].subtask_no+'</td>'
                                innerHtmlTask+='<td>'+arrayTask[i].start_date+'/'+arrayTask[i].start_time+'</td>'
                                innerHtmlTask+='<td>'+arrayTask[i].end_date+'/'+arrayTask[i].end_time+'</td>'
                                innerHtmlTask+='</tr>'
                                
                            }
                            for(let i = 0; dataResult.routine.length > i; i++){
                                if(arrayRoutine[i].times_done){
                                innerHtmlRoutine += '<tr>'
                                innerHtmlRoutine += '<td colspan="2" class = "text-left">'+arrayRoutine[i].routine_name+'</td>'
                                innerHtmlRoutine += '<td>'+arrayRoutine[i].pomodoro+':00</td>'
                                innerHtmlRoutine += '<td>'+arrayRoutine[i].subtask_no+'</td>'
                                    innerHtmlRoutine += '<td>'+arrayRoutine[i].times_done+'</td>'
                                
                                innerHtmlRoutine += '<td><a class="dropdown-item" href="#" data-toggle = "modal" data-target = "#viewMoreModal'+i+'"  ><i class="fa fa-eye" ></i></a></td>'
                                innerHtmlRoutine += '</tr>'
                                innerHtmlRoutineModal+='<div class = "modal fade " id="viewMoreModal'+i+'" role="dialog">'
                                innerHtmlRoutineModal+='<div class = "modal-dialog  modal-xl modal-dialog-scrollable">'
                                innerHtmlRoutineModal+='<div class = "modal-content">'
                                innerHtmlRoutineModal+='<div class = "modal-header text-center d-block  "><h4 class="modal-title  d-inline-block">'+arrayRoutine[i].routine_name+'</h4></div>'
                                innerHtmlRoutineModal+='<div class = "modal-body">'
                                innerHtmlRoutineModal+='<div class = "row  justify-content-md-center text-center">'
                                innerHtmlRoutineModal+='<div class = "col-8 text-center">'
                                innerHtmlRoutineModal+='<div class = "reportsTableCard1">'
                                innerHtmlRoutineModal+='<table class="table table-striped">'
                                innerHtmlRoutineModal+='<thead>'
                                innerHtmlRoutineModal+='<tr>'
                                innerHtmlRoutineModal+='<th colspan="2">ROUTINE NAME</th>'
                                innerHtmlRoutineModal+='<th scope="col-2">TIME PER SESSION</th>'
                                innerHtmlRoutineModal+=' <th scope="col-2">NO. OF SUBTASKS</th>'
                                // innerHtmlRoutineModal+='<th scope="col-2">NO. OF TIMES</th></th>'
                                innerHtmlRoutineModal+=' <th scope="col-2">TIME/DATE COMPLETED'
                                innerHtmlRoutineModal+='</tr>'
                                innerHtmlRoutineModal+='<tbody>'
                                    for(let x = 0; dataResult.routine[i].history.length > x; x++){
                                        innerHtmlRoutineModal += '<tr>'
                                        innerHtmlRoutineModal += '<td colspan="2" class = "text-left">'+dataResult.routine[i].history[x].routine_name+'</td>'
                                        innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x].pomodoro+':00</td>'
                                        innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x].no_of_task+'</td>'
                                        // innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x]+'</td>'
                                        innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x].end_date+'</td>'
                                        innerHtmlRoutineModal += '</tr>'
                                    }
                                
                                innerHtmlRoutineModal+='</tbody>'
                                innerHtmlRoutineModal+=' </table>'
                                innerHtmlRoutineModal+=' </div>'



                            innerHtmlRoutineModal+='</div>'
                        innerHtmlRoutineModal+='</div>'
                        innerHtmlRoutineModal+='</div>'
                        innerHtmlRoutineModal+='</div>'
                        innerHtmlRoutineModal+='</div>'
                        innerHtmlRoutineModal+='</div>'
                                }
                            }

                                // console.log(arrayRoutine)
                            
                                innerHtmlTodoSummary+=dataResult.task.length
                                innerHtmlRoutineSummary += dataResult.routine.length
                               
                            $('#task').html(innerHtmlTask)
                            $('#assessments').html(innerHtmlAssessments)
                            $('#routine').html(innerHtmlRoutine)
                            $('#todoSummary1').html(innerHtmlTodoSummary)
                        
                            $('#routineSummary').html(innerHtmlRoutineSummary)
                            $('#viewMoreModal2').html(innerHtmlRoutineModal)

                        },error:function(err){
                            console.log('error')		 
                        }
                    })
                }
            </script>

</body>
</html>