<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate User Reports - Pivot</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel='stylesheet' href="../style.css">
    
</head>
<body>
    <div id="nav-placeholder">
    </div>

    <div class="container px-5 py-4 mx-auto">
        <div class="container d-flex justify-content-around ">
            <div class = "row">
            <span class = "titleRoutine text-center">
                GENERATE USER REPORTS
                <hr class="solid" id="hrWhite2">
            </span>
        </div>
        </div>
        <!-- SUMMARY OF ROUTINE -->
        <div class="container d-flex justify-content-around ">
            <div class = "row text-center">
                <div class = "col-lg-3">
                    <div class = "row">
                        <div class = "card adminInfoReports">
                            <span class = "titleRoutine1">
                               ALL USERS
                            </span>
                            <hr class = "hrWhite">
                            <div class = "row">
                                <div class = "col-2">
                            <input type="checkbox"></div><div class = "col-10"><span>SELECT ALL USERS</span></div>
                        </div>
                            <!-- ONE USER DETAIL -->
                            <div class = "row  text-center mb-1 mt-2" id = "adminScrollReports">
                              
                                <div class = "col-10 summaryNameCol">
                                    <div class = "row">
                                <div class = "col-2">
                                    <input type="checkbox" class = "reportsCheck">
                                    </div>
                                 
                                        <div class = "col-10">
                                        
                                            <span style= "font-size: 18px">lastName1</span>
                                        </div>
                                        <div class = "col-2">
                                            </div>
                                        <div class = "col-10">
                                            <short>thisslongeail.babla@blabla.com</short>
                                        </div>
                                     </div>
                                </div>
                                <div class = "col-10 summaryNameCol">
                                    <div class = "row">
                                <div class = "col-2">
                                    <input type="checkbox" class = "reportsCheck">
                                    </div>
                                 
                                        <div class = "col-10">
                                        
                                            <span style= "font-size: 18px">lastName1</span>
                                        </div>
                                        <div class = "col-2">
                                            </div>
                                        <div class = "col-10">
                                            <short>emailadd</short>
                                        </div>
                                     </div>
                                </div>
                                <div class = "col-10 summaryNameCol">
                                    <div class = "row">
                                <div class = "col-2">
                                    <input type="checkbox" class = "reportsCheck">
                                    </div>
                                 
                                        <div class = "col-10">
                                        
                                            <span style= "font-size: 18px">lastName1</span>
                                        </div>
                                        <div class = "col-2">
                                            </div>
                                        <div class = "col-10">
                                            <short>emailadd</short>
                                        </div>
                                     </div>
                                </div>
                                <div class = "col-10 summaryNameCol">
                                    <div class = "row">
                                <div class = "col-2">
                                    <input type="checkbox" class = "reportsCheck">
                                    </div>
                                 
                                        <div class = "col-10">
                                        
                                            <span style= "font-size: 18px">lastName1</span>
                                        </div>
                                        <div class = "col-2">
                                            </div>
                                        <div class = "col-10">
                                            <short>emailadd</short>
                                        </div>
                                     </div>
                                </div>
                                <div class = "col-10 summaryNameCol">
                                    <div class = "row">
                                <div class = "col-2">
                                    <input type="checkbox" class = "reportsCheck">
                                    </div>
                                 
                                        <div class = "col-10">
                                        
                                            <span style= "font-size: 18px">lastName1</span>
                                        </div>
                                        <div class = "col-2">
                                            </div>
                                        <div class = "col-10">
                                            <short>emailadd</short>
                                        </div>
                                     </div>
                                </div>
                                
                            </div>
                            <!-- END -->
        
                            
                          
                        </div>
                        
                    </div>
                    <div class = "reportsButtons">
                    <div class = "row text-center">
                        <button onClick = "window.location.href='allUserAccs.html'" class="btn-block btn-color" id = "routine_btn">VIEW ALL USERS</button>
                        <!-- <button class="btn-block btn-color" id = "routine_btn">SELECT USERS</button> -->
                        <button onClick = "window.location.href='dashboard.html'"  class="btn-block btn-color" id = "routine_btn">BACK</button></div>
                    
                   </div>
                </div>
                   
                <!-- SUB ROUTINES -->
                <div class = "col-lg-9">
                    <div class = "card reportsCard">
                        <div class = "row">
                            <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-right">
                                        DATE STARTED:
                                    </span>
                                    <div class = "col text-right mb-3">
                                        <input type="date" id="start_date" class = "dateReportS">
                                    </div>
                                </div>   
                            </div>
                            <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-left">
                                        DATE ENDED:
                                    </span>
                                    <div class = "col text-left">
                                        <input type="date" id="end_date" class = "dateReportS">
                                    </div>
                                </div>   
                            </div>
                            <div class = "row text-center">
                                <div class = "col mb-4">
                                    <button type = "button" class = "btn" onClick = "showReports()" id = "reportsSort">SORT
                                    </button>
                                </div>

                            </div>
                       
                            <hr class = "hrWhite">
                            <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-center">
                                        NO. OF TASKS COMPLETED:
                                    </span>
                                    <div class = "summaryNo text-center" id = "todoSummary1">
                                        10
                                    </div>
                                </div> 
                             </div>
                             <div class = "col-6">
                                <div class = "row">
                                    <span class = "titleReports text-center">
                                        NO. OF ROUTINES COMPLETED:
                                    </span>
                                    <div class = "summaryNo text-center" id = "routineSummary">
                                        10
                                    </div>
                                </div> 
                             </div>
                        </div>
                       
                        <hr class = "hrWhite">
                        <span class = "titleReports text-left">
                            TASK COMPLETED
                        </span>
                        <div class = "reportsTableCard">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th>#</th>
                                    <th>EMAIL ADDRESS</th>
                                    <th>TIME PER SESSION</th>
                                    <th>NO. OF SUBTASKS</th>
                                    <th>TIME/DATE COMPLETED</th>
                                  </tr>
                                </thead>
                                <tbody id="task">
                                    <td></td>
                                    <td colspan="4"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                  </tr>
                                  <!-- END OF ONE TASK REPORT -->
                                </tbody>
                            </table>
                        </div>
                        <hr class = "hrWhite">
                        <span class = "titleReports text-left">
                            ROUTINES COMPLETED
                        </span>
                        <div class = "reportsTableCard">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th scope="col-2">#</th>
                                    <th colspan="2">EMAIL ADDRESS</th>
                                    <th>TIME PER SESSION</th>
                                    <th>NO. OF SUBTASKS</th>
                                    <th>NO. OF TIMES</th>
                                  </tr>
                                </thead>
                                <tbody id="routine">
                                    <!-- ONE ROUTINE REPORT -->
                                  <tr>
                                    <td colspan="2" class = "text-left"></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                  </tr>
                                  <!-- END OF ONE ROUTINE REPORT -->
                                </tbody>
                            </table>
                        </div>
                        <hr class = "hrWhite">
                        <span class = "titleReports text-left">
                            ASSESSMENTS COMPLETED
                        </span>
                        <div class = "reportsTableCard">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th scope="col-1">#</th>
                                    <th colspan="2">EMAIL ADDRESS</th>
                                    <th scope="col-1">POINTS</th>
                                   
                                    <th scope="col-1">TIME/DATE COMPLETED</th>
                                    
                                  </tr>
                                </thead>
                                <tbody id="assessments">
                                    <!-- ONE ROUTINE REPORT -->
                                  <tr>
                                    
                                    <td></td>
                                    <td colspan="2" class = "text-left"></td>
                                    <td></td>
                                    <td colspan="2" class = "text-left"></td>
                                  </tr>
                                  <!-- END OF ONE ROUTINE REPORT -->
                                </tbody>
                            </table>
                        </div>


                                


                    </div>
                </div>
           
            </div>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script>
    $.get("../navigationBar.html", function(data){
        $("#nav-placeholder").replaceWith(data);
        });
    </script>
     <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
     <script>
         window.onload = function() {
     if(!window.location.hash) {
         window.location = window.location + '#loaded';
         window.location.reload();
     }
     showReports()
     window.onpageshow = function (event) {
         if (event.persisted) {
             window.location.reload(); //reload page if it has been loaded from cache
         }
         };
     }
     if(!localStorage.getItem('user_id')||localStorage.getItem('emailAdd')!="pivotacc.pomodoro@gmail.com"){
       
 
             window.location = "http://localhost/pomodoro/timer.html";
         };

        function showReports(){
                var params = []
                
                $.ajax({
                    type:"POST",
                    url: "http://localhost/pomodoro/api/admin_reports.php",
                    dataType: "json",
                    data:{
                        end_date: document.getElementById('end_date').value,
                        start_date: document.getElementById('start_date').value,
                        user_id: params,
                    },
                    
                    cache:false,
                    success: function(dataResult){
                        var arrayAssessments = dataResult.assessments;
                        var arrayTask = dataResult.task;
                        var arrayRoutine = dataResult.routine;
                        console.log(dataResult)

                        var innerHtmlAssessments = ''
                        var innerHtmlTask = ''
                        var innerHtmlRoutine = ''
                        var innerHtmlTodoSummary = ''
                        var innerHtmlRoutineModal = ''
                        var innerHtmlRoutineSummary = ''
                        
                        
                        for(let i = 0; dataResult.assessments.length > i; i++){
                            var managementSkill = ''
                            if(arrayAssessments[i].points >= 45 && arrayAssessments[i].points <= 50 ){
                                managementSkill = 'You have excellent time mangament skills and should use this guide as a reference	 '
                            }else if(arrayAssessments[i].points >= 30 && arrayAssessments[i].points <= 44){
                                managementSkill = 'You manage your time fairly well but should use this guide to increase skill'

                            }else{
                                managementSkill = 'Your time management skill should be improved for college but not panic, following the subsquent guidelines will assist you in improving your ability and further your chances of success'
                            }
                            innerHtmlAssessments+='<tr>'
                            innerHtmlAssessments+='<td>'+parseInt(i+1)+'</td>'
                            innerHtmlAssessments+='<td>'+arrayAssessments[i].points+'</td>'
                            innerHtmlAssessments+='<td colspan="2" class = "text-center">'+managementSkill+'</td>'
                            innerHtmlAssessments+='<td>'+arrayAssessments[i].date_created+'/'+arrayAssessments[i].time_created+'</td>'
                            innerHtmlAssessments+='</tr>'
                        }
                        for(let i = 0; dataResult.task.length > i; i++){
                            todoSum = i;
                            innerHtmlTask+='<tr>'
                            innerHtmlTask+='<td colspan="2" class = "text-left">'+arrayTask[i].task_name+'</td>'
                            innerHtmlTask+='<td>'+arrayTask[i].pomodoro+':00</td>'
                            innerHtmlTask+='<td>'+arrayTask[i].subtask_no+'</td>'
                            innerHtmlTask+='<td>'+arrayTask[i].start_date+'/'+arrayTask[i].start_time+'</td>'
                            innerHtmlTask+='<td>'+arrayTask[i].end_date+'/'+arrayTask[i].end_time+'</td>'
                            innerHtmlTask+='</tr>'
                            
                        }
                        for(let i = 0; dataResult.routine.length > i; i++){
                            if(arrayRoutine[i].times_done){
                            innerHtmlRoutine += '<tr>'
                            innerHtmlRoutine += '<td colspan="2" class = "text-left">'+arrayRoutine[i].routine_name+'</td>'
                            innerHtmlRoutine += '<td>'+arrayRoutine[i].pomodoro+':00</td>'
                            innerHtmlRoutine += '<td>'+arrayRoutine[i].subtask_no+'</td>'
                                innerHtmlRoutine += '<td>'+arrayRoutine[i].times_done+'</td>'
                            
                            innerHtmlRoutine += '<td><a class="dropdown-item" href="#" data-toggle = "modal" data-target = "#viewMoreModal'+i+'"  ><i class="fa fa-eye" ></i></a></td>'
                            innerHtmlRoutine += '</tr>'
                            innerHtmlRoutineModal+='<div class = "modal fade " id="viewMoreModal'+i+'" role="dialog">'
                            innerHtmlRoutineModal+='<div class = "modal-dialog  modal-xl modal-dialog-scrollable">'
                            innerHtmlRoutineModal+='<div class = "modal-content">'
                            innerHtmlRoutineModal+='<div class = "modal-header text-center d-block  "><h4 class="modal-title  d-inline-block">'+arrayRoutine[i].routine_name+'</h4></div>'
                            innerHtmlRoutineModal+='<div class = "modal-body">'
                            innerHtmlRoutineModal+='<div class = "row  justify-content-md-center text-center">'
                            innerHtmlRoutineModal+='<div class = "col-8 text-center">'
                            innerHtmlRoutineModal+='<div class = "reportsTableCard1">'
                            innerHtmlRoutineModal+='<table class="table table-striped">'
                            innerHtmlRoutineModal+='<thead>'
                            innerHtmlRoutineModal+='<tr>'
                            innerHtmlRoutineModal+='<th colspan="2">ROUTINE NAME</th>'
                            innerHtmlRoutineModal+='<th scope="col-2">TIME PER SESSION</th>'
                            innerHtmlRoutineModal+=' <th scope="col-2">NO. OF SUBTASKS</th>'
                            // innerHtmlRoutineModal+='<th scope="col-2">NO. OF TIMES</th></th>'
                            innerHtmlRoutineModal+=' <th scope="col-2">TIME/DATE COMPLETED'
                            innerHtmlRoutineModal+='</tr>'
                            innerHtmlRoutineModal+='<tbody>'
                                for(let x = 0; dataResult.routine[i].history.length > x; x++){
                                    innerHtmlRoutineModal += '<tr>'
                                    innerHtmlRoutineModal += '<td colspan="2" class = "text-left">'+dataResult.routine[i].history[x].routine_name+'</td>'
                                    innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x].pomodoro+':00</td>'
                                    innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x].no_of_task+'</td>'
                                    // innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x]+'</td>'
                                    innerHtmlRoutineModal += '<td>'+dataResult.routine[i].history[x].end_date+'</td>'
                                    innerHtmlRoutineModal += '</tr>'
                                }
                            
                            innerHtmlRoutineModal+='</tbody>'
                            innerHtmlRoutineModal+=' </table>'
                            innerHtmlRoutineModal+=' </div>'



                        innerHtmlRoutineModal+='</div>'
                    innerHtmlRoutineModal+='</div>'
                    innerHtmlRoutineModal+='</div>'
                    innerHtmlRoutineModal+='</div>'
                    innerHtmlRoutineModal+='</div>'
                    innerHtmlRoutineModal+='</div>'
                            }
                        }

                            // console.log(arrayRoutine)
                        
                            innerHtmlTodoSummary+=dataResult.task.length
                            innerHtmlRoutineSummary += dataResult.routine.length
                            
                        // $('#task').html(innerHtmlTask)
                        // $('#assessments').html(innerHtmlAssessments)
                        // $('#routine').html(innerHtmlRoutine)
                        // $('#todoSummary1').html(innerHtmlTodoSummary)
                    
                        // $('#routineSummary').html(innerHtmlRoutineSummary)
                        // $('#viewMoreModal2').html(innerHtmlRoutineModal)

                    },error:function(err){
                        console.log('error')		 
                    }
                })
            }
             
        
 
     </script>
   


</body>
</html>